pipeline {
    agent any
    
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/WissalMonastiri/student-management.git'
            }
        }
        
        stage('Build') {
            steps {
                dir('student-management') {
                    sh '''
                        chmod +x mvnw
                        ./mvnw clean package -DskipTests
                        echo "‚úÖ APPLICATION CONSTRUITE!"
                        echo "üì¶ JAR: target/student-management-*.jar"
                    '''
                }
            }
        }
        
        stage('Manual Steps') {
            steps {
                script {
                    echo """
                    ‚ö†Ô∏è MANUEL - Ex√©cutez CES commandes SUR LE SERVEUR:
                    
                    1. Ouvrez un terminal sur le serveur Jenkins
                    2. Ex√©cutez:
                    
                    cd /var/lib/jenkins/workspace/Pipeline\\ script/student-management
                    docker build -t wissal93/student-management:1.0 .
                    docker login -u wissal93
                    docker push wissal93/student-management:1.0
                    
                    üìç L'application est d√©j√† construite.
                    """
                }
            }
        }
    }
    
    post {
        success {
            echo '‚úÖ TERMIN√â! Ex√©cutez les commandes Docker manuellement.'
            archiveArtifacts artifacts: 'student-management/target/*.jar', fingerprint: true
        }
    }
}
